<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SalinWika - Learn. Speak. Connect Generations. üáµüá≠</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #3498DB 0%, #1ABC9C 50%, #F1C40F 100%);
            min-height: 100vh;
            color: #2d3748;
            overflow-x: hidden;
        }
        
        .floating-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .shape {
            position: absolute;
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }
        
        .shape:nth-child(1) {
            width: 80px;
            height: 80px;
            background: rgba(241, 196, 15, 0.3);
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .shape:nth-child(2) {
            width: 60px;
            height: 60px;
            background: rgba(26, 188, 156, 0.3);
            top: 20%;
            right: 10%;
            animation-delay: 2s;
        }
        
        .shape:nth-child(3) {
            width: 100px;
            height: 100px;
            background: rgba(193, 154, 107, 0.3);
            bottom: 20%;
            left: 5%;
            animation-delay: 4s;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, #FEF9F3 0%, #ffffff 100%);
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(193, 154, 107, 0.2);
            margin-bottom: 30px;
            border: 3px solid #C19A6B;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            background: linear-gradient(135deg, #F1C40F, #C19A6B, #1ABC9C);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 3.5rem;
            font-weight: 900;
            margin-bottom: 15px;
            text-shadow: 0 4px 8px rgba(193, 154, 107, 0.3);
        }
        
        .header p {
            color: #C19A6B;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .lesson-selector {
            background: linear-gradient(135deg, #FEF9F3 0%, #ffffff 100%);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 15px 40px rgba(193, 154, 107, 0.15);
            border: 2px solid #D8BFAA;
        }
        
        .lesson-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .lesson-card {
            background: linear-gradient(135deg, #ffffff, #FEF9F3);
            border-radius: 20px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #E5E5E5;
            text-align: center;
            box-shadow: 0 8px 25px rgba(193, 154, 107, 0.1);
        }
        
        .lesson-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(241, 196, 15, 0.2);
            border-color: #FFE066;
        }
        
        .lesson-card.active {
            border-color: #F1C40F;
            background: linear-gradient(135deg, #F1C40F, #FFE066);
            color: white;
            box-shadow: 0 15px 40px rgba(241, 196, 15, 0.4);
        }
        
        .lesson-emoji {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .lesson-name {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .lesson-description {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        .progress-bar {
            background: linear-gradient(135deg, #FEF9F3, #ffffff);
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(193, 154, 107, 0.15);
            border: 2px solid #D8BFAA;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .lesson-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #C19A6B;
        }
        
        .stars {
            display: flex;
            gap: 5px;
        }
        
        .star {
            font-size: 1.5rem;
            color: #E74C3C;
            animation: sparkle 2s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .progress-track {
            background: #E5E5E5;
            height: 12px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #2ECC71, #1ABC9C);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .lesson-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .lesson-step {
            padding: 15px 25px;
            background: linear-gradient(135deg, #FEF9F3, #E5E5E5);
            border: 2px solid #D8BFAA;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(193, 154, 107, 0.15);
            position: relative;
            overflow: hidden;
            color: #C19A6B;
        }
        
        .lesson-step:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(241, 196, 15, 0.3);
            border-color: #F1C40F;
        }
        
        .lesson-step.active {
            background: linear-gradient(135deg, #1ABC9C, #4DD0E1);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(26, 188, 156, 0.4);
            border-color: #1ABC9C;
        }
        
        .lesson-step.completed {
            background: linear-gradient(135deg, #2ECC71, #1ABC9C);
            color: white;
            border-color: #2ECC71;
        }
        
        .lesson-content {
            background: linear-gradient(135deg, #FEF9F3 0%, #ffffff 100%);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 15px 40px rgba(193, 154, 107, 0.1);
            margin-bottom: 25px;
            border: 2px solid #D8BFAA;
            min-height: 500px;
        }
        
        .step-content {
            display: none;
            animation: fadeInUp 0.5s ease;
        }
        
        .step-content.active {
            display: block;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .intro-section {
            text-align: center;
            margin: 30px 0;
        }
        
        .intro-emoji {
            font-size: 8rem;
            margin: 30px 0;
            animation: bounce 2s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .intro-text {
            font-size: 1.4rem;
            color: #C19A6B;
            line-height: 1.8;
            margin: 20px 0;
            font-weight: 500;
        }
        
        .vocabulary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .vocab-card {
            background: linear-gradient(135deg, #ffffff, #FEF9F3);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(193, 154, 107, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #D8BFAA;
            position: relative;
        }
        
        .vocab-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 50px rgba(26, 188, 156, 0.2);
            border-color: #1ABC9C;
        }
        
        .vocab-emoji {
            font-size: 4rem;
            margin-bottom: 15px;
        }
        
        .vocab-english {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 10px 0;
            color: #C19A6B;
        }
        
        .vocab-filipino {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1ABC9C;
            margin-bottom: 15px;
        }
        
        .play-sound {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        
        .play-sound:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.5);
            background: linear-gradient(135deg, #C0392B, #E74C3C);
        }
        
        .edit-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #1ABC9C;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .edit-btn:hover {
            background: #16A085;
            transform: scale(1.1);
        }
        
        .add-word-section {
            background: linear-gradient(135deg, #2ECC71, rgba(46, 204, 113, 0.1));
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            border: 2px dashed #2ECC71;
            text-align: center;
        }
        
        .add-word-btn {
            background: linear-gradient(135deg, #2ECC71, #27AE60);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.3);
        }
        
        .add-word-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(46, 204, 113, 0.4);
        }
        
        .game-area {
            background: linear-gradient(135deg, #FEF9F3, #7EC8E3);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 3px dashed #3498DB;
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.15);
        }
        
        .game-question {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            color: #C19A6B;
            margin-bottom: 25px;
        }
        
        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        
        .matching-column {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
        }
        
        .matching-column h3 {
            text-align: center;
            color: #C19A6B;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .match-item {
            background: white;
            border: 3px solid #D8BFAA;
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .match-item:hover {
            transform: scale(1.05);
            border-color: #1ABC9C;
        }
        
        .match-item.selected {
            border-color: #F1C40F;
            background: #FFE066;
            color: white;
        }
        
        .match-item.correct {
            border-color: #2ECC71;
            background: #2ECC71;
            color: white;
        }
        
        .game-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .game-option {
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #D8BFAA;
            background: linear-gradient(135deg, #ffffff, #FEF9F3);
            text-align: center;
            min-width: 120px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #C19A6B;
            box-shadow: 0 6px 20px rgba(193, 154, 107, 0.1);
        }
        
        .game-option:hover {
            transform: scale(1.1);
            border-color: #1ABC9C;
            box-shadow: 0 10px 30px rgba(26, 188, 156, 0.2);
        }
        
        .phrases-section {
            margin: 30px 0;
        }
        
        .phrase-card {
            background: linear-gradient(135deg, #ffffff, #FEF9F3);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 8px 25px rgba(193, 154, 107, 0.1);
            border-left: 5px solid #1ABC9C;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .phrase-card:hover {
            transform: translateX(10px);
            box-shadow: 0 12px 35px rgba(26, 188, 156, 0.2);
            border-left-color: #F1C40F;
        }
        
        .phrase-english {
            font-size: 1.2rem;
            color: #C19A6B;
            margin-bottom: 8px;
        }
        
        .phrase-filipino {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1ABC9C;
        }
        
        .song-section {
            background: linear-gradient(135deg, #F1C40F, #FFE066);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 15px 40px rgba(241, 196, 15, 0.3);
        }
        
        .song-title {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(193, 154, 107, 0.5);
        }
        
        .song-lyrics {
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
            line-height: 2;
            margin: 20px 0;
            text-shadow: 0 1px 3px rgba(193, 154, 107, 0.3);
        }
        
        .play-song {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }
        
        .play-song:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(231, 76, 60, 0.5);
        }
        
        .parent-guide {
            background: linear-gradient(135deg, #2ECC71, rgba(46, 204, 113, 0.1));
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            border-left: 5px solid #2ECC71;
            box-shadow: 0 10px 30px rgba(46, 204, 113, 0.15);
        }
        
        .parent-guide h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .parent-guide p {
            color: white;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .nav-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .prev-btn {
            background: linear-gradient(135deg, #3498DB, #7EC8E3);
            color: white;
        }
        
        .next-btn {
            background: linear-gradient(135deg, #2ECC71, #1ABC9C);
            color: white;
        }
        
        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.2);
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .practice-button {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
        }
        
        .practice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(231, 76, 60, 0.4);
        }
        
        .memory-boost {
            background: linear-gradient(135deg, #F1C40F, rgba(255, 224, 102, 0.3));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #FFE066;
            box-shadow: 0 10px 30px rgba(241, 196, 15, 0.2);
        }
        
        .memory-boost h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .memory-boost p {
            color: white;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #FEF9F3, #ffffff);
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal h3 {
            color: #C19A6B;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #D8BFAA;
            border-radius: 10px;
            font-size: 1.1rem;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .save-btn {
            background: linear-gradient(135deg, #2ECC71, #27AE60);
            color: white;
        }
        
        .cancel-btn {
            background: linear-gradient(135deg, #95A5A6, #7F8C8D);
            color: white;
        }
        
        /* Responsive Design for All Devices */
        @media (max-width: 1200px) {
            .container {
                max-width: 95%;
                padding: 15px;
            }
            
            .header h1 {
                font-size: 3rem;
            }
            
            .lesson-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 25px 20px;
                margin-bottom: 20px;
            }
            
            .header h1 {
                font-size: 2.5rem;
                margin-bottom: 10px;
            }
            
            .header p {
                font-size: 1.1rem;
            }
            
            .lesson-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .lesson-card {
                padding: 20px;
            }
            
            .lesson-nav {
                flex-direction: column;
                gap: 10px;
            }
            
            .lesson-step {
                padding: 12px 20px;
                font-size: 0.9rem;
                width: 100%;
                text-align: center;
            }
            
            .vocabulary-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .vocab-card {
                padding: 20px 15px;
            }
            
            .vocab-emoji {
                font-size: 3rem;
            }
            
            .vocab-english {
                font-size: 1.1rem;
            }
            
            .vocab-filipino {
                font-size: 1rem;
            }
            
            .matching-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .game-question {
                font-size: 1.5rem;
            }
            
            .song-title {
                font-size: 1.6rem;
            }
            
            .song-lyrics {
                font-size: 1.2rem;
            }
            
            .intro-emoji {
                font-size: 6rem;
            }
            
            .intro-text {
                font-size: 1.2rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-btn {
                width: 100%;
                padding: 15px;
            }
            
            .modal-content {
                margin: 5% auto;
                width: 95%;
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .vocabulary-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .vocab-card {
                padding: 15px;
            }
            
            .vocab-emoji {
                font-size: 2.5rem;
            }
            
            .lesson-content {
                padding: 25px 20px;
            }
            
            .game-area {
                padding: 20px 15px;
            }
            
            .song-section {
                padding: 20px 15px;
            }
            
            .intro-emoji {
                font-size: 4rem;
            }
            
            .intro-text {
                font-size: 1.1rem;
            }
            
            .lesson-step {
                padding: 10px 15px;
                font-size: 0.8rem;
            }
            
            .phrase-card {
                padding: 15px;
            }
            
            .phrase-english {
                font-size: 1.1rem;
            }
            
            .phrase-filipino {
                font-size: 1.2rem;
            }
        }
        
        /* Touch-friendly buttons for mobile */
        @media (hover: none) and (pointer: coarse) {
            .vocab-card, .lesson-card, .phrase-card, .match-item {
                min-height: 44px; /* iOS recommended touch target */
            }
            
            .play-sound, .practice-button, .nav-btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            .edit-btn {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
        }
        
        /* Landscape orientation adjustments */
        @media (max-width: 768px) and (orientation: landscape) {
            .intro-emoji {
                font-size: 4rem;
                margin: 15px 0;
            }
            
            .header {
                padding: 20px;
            }
            
            .lesson-content {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>
    
    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h3>‚úèÔ∏è Edit Word/Phrase</h3>
            <input type="text" id="editEnglish" placeholder="English word/phrase">
            <input type="text" id="editFilipino" placeholder="Filipino translation">
            <input type="text" id="editDialect" placeholder="Your dialect translation (optional)">
            <input type="text" id="editEmoji" placeholder="Emoji (optional)">
            <input type="text" id="editImage" placeholder="Image URL, SVG code, or data:image URL (optional)">
            <div style="font-size: 0.9rem; color: #C19A6B; margin: 10px 0; text-align: left;">
                <strong>üì∏ Image Options:</strong><br>
                ‚Ä¢ Emoji: üçé üêï üåà<br>
                ‚Ä¢ Image URL: https://example.com/image.jpg<br>
                ‚Ä¢ SVG: &lt;svg&gt;...&lt;/svg&gt;<br>
                ‚Ä¢ Base64: data:image/png;base64,...
            </div>
            <div class="modal-buttons">
                <button class="modal-btn save-btn" onclick="saveEdit()">üíæ Save</button>
                <button class="modal-btn cancel-btn" onclick="closeModal()">‚ùå Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Add Word Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <h3>‚ûï Add New Word/Phrase</h3>
            <input type="text" id="addEnglish" placeholder="English word/phrase">
            <input type="text" id="addFilipino" placeholder="Filipino translation">
            <input type="text" id="addDialect" placeholder="Your dialect translation (optional)">
            <input type="text" id="addEmoji" placeholder="Emoji (optional)">
            <input type="text" id="addImage" placeholder="Image URL, SVG code, or data:image URL (optional)">
            <div style="font-size: 0.9rem; color: #C19A6B; margin: 10px 0; text-align: left;">
                <strong>üì∏ Image Options:</strong><br>
                ‚Ä¢ Emoji: üçé üêï üåà<br>
                ‚Ä¢ Image URL: https://example.com/image.jpg<br>
                ‚Ä¢ SVG: &lt;svg&gt;...&lt;/svg&gt;<br>
                ‚Ä¢ Base64: data:image/png;base64,...
            </div>
            <div style="font-size: 0.9rem; color: #9B59B6; margin: 10px 0; text-align: left;">
                <strong>üó£Ô∏è Dialect Audio:</strong> Your dialect words will have special pronunciation with slower, clearer speech!
            </div>
            <div class="modal-buttons">
                <button class="modal-btn save-btn" onclick="addNewWord()">‚ûï Add</button>
                <button class="modal-btn cancel-btn" onclick="closeModal()">‚ùå Cancel</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>üåü SalinWika üåü</h1>
            <p>Play. Speak. Celebrate Filipino! üöÄ‚ú®</p>
            <div style="margin-top: 20px;">
                <button onclick="generateAllFilipinoPronunciations()" style="
                    background: linear-gradient(135deg, #E74C3C, #C0392B);
                    color: white;
                    border: none;
                    padding: 15px 30px;
                    border-radius: 25px;
                    font-size: 1.1rem;
                    font-weight: 700;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
                " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 15px 40px rgba(231, 76, 60, 0.5)'" onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='0 8px 25px rgba(231, 76, 60, 0.4)'">
                    üéµ Generate Filipino Audio
                </button>
                <div style="font-size: 0.9rem; color: #C19A6B; margin-top: 10px; font-weight: 500;">
                    Click to create authentic pronunciations for all words!
                </div>
            </div>
        </div>
        
        <div class="lesson-selector">
            <h2 style="text-align: center; margin-bottom: 20px; font-size: 2rem; color: #C19A6B;">Choose Your Lesson</h2>
            <div class="lesson-grid">
                <div class="lesson-card active" onclick="selectLesson(1)">
                    <div class="lesson-emoji">üåà</div>
                    <div class="lesson-name">Colors</div>
                    <div class="lesson-description">Mga Kulay</div>
                </div>
                <div class="lesson-card" onclick="selectLesson(2)">
                    <div class="lesson-emoji">üî¢</div>
                    <div class="lesson-name">Numbers</div>
                    <div class="lesson-description">Mga Numero</div>
                </div>
                <div class="lesson-card" onclick="selectLesson(3)">
                    <div class="lesson-emoji">üêæ</div>
                    <div class="lesson-name">Animals</div>
                    <div class="lesson-description">Mga Hayop</div>
                </div>
                <div class="lesson-card" onclick="selectLesson(4)">
                    <div class="lesson-emoji">üçé</div>
                    <div class="lesson-name">Food</div>
                    <div class="lesson-description">Mga Pagkain</div>
                </div>
                <div class="lesson-card" onclick="selectLesson(5)">
                    <div class="lesson-emoji">üë§</div>
                    <div class="lesson-name">Body Parts</div>
                    <div class="lesson-description">Mga Bahagi ng Katawan</div>
                </div>
                <div class="lesson-card" onclick="selectLesson(6)">
                    <div class="lesson-emoji">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                    <div class="lesson-name">Family</div>
                    <div class="lesson-description">Pamilya</div>
                </div>
                <div class="lesson-card" onclick="selectLesson(7)">
                    <div class="lesson-emoji">üí¨</div>
                    <div class="lesson-name">Daily Words</div>
                    <div class="lesson-description">Araw-araw</div>
                </div>
                <div class="lesson-card" onclick="selectLesson(8)">
                    <div class="lesson-emoji">üéÆ</div>
                    <div class="lesson-name">Filipino Games</div>
                    <div class="lesson-description">Mga Laro</div>
                </div>
            </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress-info">
                <div class="lesson-title" id="current-lesson-title">Lesson 1: Mga Kulay (Colors)</div>
                <div class="stars">
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                    <span class="star">‚≠ê</span>
                </div>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="progress-fill" style="width: 16.67%"></div>
            </div>
        </div>
        
        <div class="lesson-nav">
            <button class="lesson-step active" onclick="showStep(1)">üéß Listen & Learn</button>
            <button class="lesson-step" onclick="showStep(2)">üìö See & Hear</button>
            <button class="lesson-step" onclick="showStep(3)">üéÆ Play & Match</button>
            <button class="lesson-step" onclick="showStep(4)">üí¨ Daily Talk</button>
            <button class="lesson-step" onclick="showStep(5)">üéµ Sing Along</button>
            <button class="lesson-step" onclick="showStep(6)">üèÜ Practice More</button>
        </div>
        
        <div class="lesson-content" id="lesson-content">
            <!-- Dynamic content will be loaded here -->
        </div>
        
        <div class="navigation-buttons">
            <button class="nav-btn prev-btn" onclick="previousStep()" id="prev-btn" disabled>‚Üê Previous</button>
            <button class="nav-btn next-btn" onclick="nextStep()" id="next-btn">Next ‚Üí</button>
        </div>
    </div>
    
    <script>
        let currentLesson = 1;
        let currentStep = 1;
        let currentEditIndex = -1;
        let currentEditType = '';
        let matchingGame = {
            selectedLeft: null,
            selectedRight: null,
            matches: 0,
            total: 0
        };
        
        // Autosave and restore functionality
        function saveToLocalStorage() {
            try {
                const saveData = {
                    lessons: lessons,
                    currentLesson: currentLesson,
                    currentStep: currentStep,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('salinwika_data', JSON.stringify(saveData));
                console.log('‚úÖ Data saved automatically!');
            } catch (error) {
                console.error('‚ùå Failed to save data:', error);
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('salinwika_data');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    lessons = data.lessons || lessons;
                    currentLesson = data.currentLesson || 1;
                    currentStep = data.currentStep || 1;
                    console.log('‚úÖ Data restored from previous session!');
                    return true;
                }
            } catch (error) {
                console.error('‚ùå Failed to load saved data:', error);
            }
            return false;
        }
        
        // Auto-save every 30 seconds
        setInterval(saveToLocalStorage, 30000);
        
        // Lesson data structure (now editable)
        let lessons = {
            1: {
                title: "Lesson 1: Mga Kulay (Colors)",
                emoji: "üåà",
                vocabulary: [
                    { english: "Red", filipino: "Pula", emoji: "üçé" },
                    { english: "Blue", filipino: "Asul", emoji: "üåä" },
                    { english: "Green", filipino: "Berde", emoji: "üåø" },
                    { english: "Black", filipino: "Itim", emoji: "üê±" },
                    { english: "White", filipino: "Puti", emoji: "ü•õ" }
                ],
                phrases: [
                    { english: "My dress is red.", filipino: "Pula ang damit ko." },
                    { english: "The sea is blue.", filipino: "Asul ang dagat." },
                    { english: "The grass is green.", filipino: "Berde ang damo." },
                    { english: "What color is this?", filipino: "Anong kulay ito?" },
                    { english: "I like red.", filipino: "Gusto ko ang pula." }
                ],
                song: {
                    title: "Color Song",
                    lyrics: "Pula, asul, berde rin,<br>Itim, puti, mga kulay natin...<br>Matuto tayo ng mga kulay,<br>Sa Filipino, masaya!"
                }
            },
            2: {
                title: "Lesson 2: Mga Numero (Numbers)",
                emoji: "üî¢",
                vocabulary: [
                    { english: "One", filipino: "Isa", emoji: "1Ô∏è‚É£" },
                    { english: "Two", filipino: "Dalawa", emoji: "2Ô∏è‚É£" },
                    { english: "Three", filipino: "Tatlo", emoji: "3Ô∏è‚É£" },
                    { english: "Four", filipino: "Apat", emoji: "4Ô∏è‚É£" },
                    { english: "Five", filipino: "Lima", emoji: "5Ô∏è‚É£" }
                ],
                phrases: [
                    { english: "I have one apple.", filipino: "May isang mansanas ako." },
                    { english: "Two cats are playing.", filipino: "Dalawang pusa ang naglalaro." },
                    { english: "Count to five.", filipino: "Bilangin hanggang lima." },
                    { english: "How many?", filipino: "Ilan?" },
                    { english: "I am five years old.", filipino: "Limang taon na ako." }
                ],
                song: {
                    title: "Counting Song",
                    lyrics: "Isa, dalawa, tatlo pa,<br>Apat, lima, bilang na!<br>Matuto tayo mag-bilang,<br>Sa Filipino, masayang!"
                }
            },
            3: {
                title: "Lesson 3: Mga Hayop (Animals)",
                emoji: "üêæ",
                vocabulary: [
                    { english: "Dog", filipino: "Aso", emoji: "üêï" },
                    { english: "Cat", filipino: "Pusa", emoji: "üê±" },
                    { english: "Bird", filipino: "Ibon", emoji: "üê¶" },
                    { english: "Fish", filipino: "Isda", emoji: "üêü" },
                    { english: "Cow", filipino: "Baka", emoji: "üêÑ" }
                ],
                phrases: [
                    { english: "The dog is barking.", filipino: "Tumatahol ang aso." },
                    { english: "I see a bird.", filipino: "Nakakita ako ng ibon." },
                    { english: "The cat is sleeping.", filipino: "Natutulog ang pusa." },
                    { english: "Fish swim in water.", filipino: "Lumalangoy ang isda sa tubig." },
                    { english: "I love animals.", filipino: "Mahal ko ang mga hayop." }
                ],
                song: {
                    title: "Animal Song",
                    lyrics: "Aso, pusa, ibon din,<br>Isda, baka, mga kaibigan...<br>Mga hayop ay masaya,<br>Alagaan natin sila!"
                }
            },
            4: {
                title: "Lesson 4: Mga Pagkain (Food)",
                emoji: "üçé",
                vocabulary: [
                    { english: "Rice", filipino: "Kanin", emoji: "üçö" },
                    { english: "Fish", filipino: "Isda", emoji: "üêü" },
                    { english: "Banana", filipino: "Saging", emoji: "üçå" },
                    { english: "Mango", filipino: "Mangga", emoji: "ü•≠" },
                    { english: "Bread", filipino: "Tinapay", emoji: "üçû" }
                ],
                phrases: [
                    { english: "I want to eat rice.", filipino: "Gusto kong kumain ng kanin." },
                    { english: "The mango is sweet.", filipino: "Matamis ang mangga." },
                    { english: "Have you eaten?", filipino: "Kumain ka na ba?" },
                    { english: "I'm hungry.", filipino: "Gutom na ako." },
                    { english: "This is delicious.", filipino: "Masarap ito." }
                ],
                song: {
                    title: "Food Song",
                    lyrics: "Kanin, isda, saging pa,<br>Mangga, tinapay, masarap na!<br>Kumain tayo ng masustansya,<br>Para maging malakas ka!"
                }
            },
            5: {
                title: "Lesson 5: Mga Bahagi ng Katawan (Body Parts)",
                emoji: "üë§",
                vocabulary: [
                    { english: "Head", filipino: "Ulo", emoji: "üë§" },
                    { english: "Eyes", filipino: "Mata", emoji: "üëÄ" },
                    { english: "Nose", filipino: "Ilong", emoji: "üëÉ" },
                    { english: "Mouth", filipino: "Bibig", emoji: "üëÑ" },
                    { english: "Hands", filipino: "Kamay", emoji: "‚úã" }
                ],
                phrases: [
                    { english: "Touch your head.", filipino: "Hawakan ang ulo mo." },
                    { english: "Close your eyes.", filipino: "Pikit ang mata mo." },
                    { english: "Open your mouth.", filipino: "Buksan ang bibig mo." },
                    { english: "Clap your hands.", filipino: "Palakpakan ang kamay mo." },
                    { english: "My nose is small.", filipino: "Maliit ang ilong ko." }
                ],
                song: {
                    title: "Body Parts Song",
                    lyrics: "Ulo, mata, ilong din,<br>Bibig, kamay, mga bahagi natin...<br>Alagaan natin ang katawan,<br>Para maging malusog tayo!"
                }
            },
            6: {
                title: "Lesson 6: Pamilya (Family)",
                emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
                vocabulary: [
                    { english: "Mother", filipino: "Nanay", emoji: "üë©" },
                    { english: "Father", filipino: "Tatay", emoji: "üë®" },
                    { english: "Sister", filipino: "Ate", emoji: "üëß" },
                    { english: "Brother", filipino: "Kuya", emoji: "üë¶" },
                    { english: "Grandmother", filipino: "Lola", emoji: "üëµ" }
                ],
                phrases: [
                    { english: "I love my family.", filipino: "Mahal ko ang pamilya ko." },
                    { english: "Where is mother?", filipino: "Nasaan si Nanay?" },
                    { english: "Father is working.", filipino: "Nagtatrabaho si Tatay." },
                    { english: "My sister is kind.", filipino: "Mabait ang ate ko." },
                    { english: "Grandmother tells stories.", filipino: "Nagkukuwento si Lola." }
                ],
                song: {
                    title: "Family Song",
                    lyrics: "Nanay, Tatay, Ate, Kuya,<br>Lola, Lolo, pamilya niya...<br>Mahal namin ang isa't isa,<br>Pamilya ay kayamanan!"
                }
            },
            7: {
                title: "Lesson 7: Araw-araw (Daily Words)",
                emoji: "üí¨",
                vocabulary: [
                    { english: "Hello", filipino: "Kumusta", emoji: "üëã" },
                    { english: "Thank you", filipino: "Salamat", emoji: "üôè" },
                    { english: "Please", filipino: "Pakisuyo", emoji: "ü§≤" },
                    { english: "Sorry", filipino: "Pasensya", emoji: "üòî" },
                    { english: "Goodbye", filipino: "Paalam", emoji: "üëã" }
                ],
                phrases: [
                    { english: "Good morning!", filipino: "Magandang umaga!" },
                    { english: "How are you?", filipino: "Kumusta ka?" },
                    { english: "Let's play!", filipino: "Laro tayo!" },
                    { english: "I'm thirsty.", filipino: "Nauuhaw ako." },
                    { english: "Help me please.", filipino: "Tulungan mo ako." }
                ],
                song: {
                    title: "Daily Words Song",
                    lyrics: "Kumusta, salamat, pakisuyo,<br>Pasensya, paalam, araw-araw mo...<br>Mga salitang ginagamit,<br>Sa bawat araw, tandaan natin!"
                }
            },
            8: {
                title: "Lesson 8: Mga Laro (Filipino Games)",
                emoji: "üéÆ",
                vocabulary: [
                    { english: "Patintero", filipino: "Patintero", emoji: "üèÉ" },
                    { english: "Hide and Seek", filipino: "Taguan", emoji: "üëÅÔ∏è" },
                    { english: "Tag", filipino: "Habulan", emoji: "üèÉ‚Äç‚ôÇÔ∏è" },
                    { english: "Jump Rope", filipino: "Luksong Lubid", emoji: "ü™¢" },
                    { english: "Hopscotch", filipino: "Piko", emoji: "‚¨ú" }
                ],
                phrases: [
                    { english: "Let's play patintero!", filipino: "Maglaro tayo ng patintero!" },
                    { english: "You're it!", filipino: "Ikaw ang taya!" },
                    { english: "I found you!", filipino: "Nakita kita!" },
                    { english: "My turn to hide.", filipino: "Ako naman ang magtago." },
                    { english: "Games are fun!", filipino: "Masaya ang mga laro!" }
                ],
                song: {
                    title: "Games Song",
                    lyrics: "Patintero, taguan din,<br>Habulan, piko, mga laro natin...<br>Maglaro tayo ng masaya,<br>Mga kaibigan, samahan mo!"
                }
            }
        };
        
        // üéµ COMPLETE FILIPINO AUDIO GENERATION SYSTEM üéµ
        const audioCache = new Map();
        let isGeneratingAudio = false;
        
        // Audio Generation Status
        const audioGenerationStatus = {
            total: 0,
            generated: 0,
            failed: 0,
            inProgress: false
        };
        
        // All Filipino words and phrases for audio generation
        const filipinoContent = {
            // Colors - Lesson 1
            'Pula': { category: 'colors', english: 'Red' },
            'Asul': { category: 'colors', english: 'Blue' },
            'Berde': { category: 'colors', english: 'Green' },
            'Itim': { category: 'colors', english: 'Black' },
            'Puti': { category: 'colors', english: 'White' },
            
            // Numbers - Lesson 2
            'Isa': { category: 'numbers', english: 'One' },
            'Dalawa': { category: 'numbers', english: 'Two' },
            'Tatlo': { category: 'numbers', english: 'Three' },
            'Apat': { category: 'numbers', english: 'Four' },
            'Lima': { category: 'numbers', english: 'Five' },
            
            // Animals - Lesson 3
            'Aso': { category: 'animals', english: 'Dog' },
            'Pusa': { category: 'animals', english: 'Cat' },
            'Ibon': { category: 'animals', english: 'Bird' },
            'Isda': { category: 'animals', english: 'Fish' },
            'Baka': { category: 'animals', english: 'Cow' },
            
            // Food - Lesson 4
            'Kanin': { category: 'food', english: 'Rice' },
            'Saging': { category: 'food', english: 'Banana' },
            'Mangga': { category: 'food', english: 'Mango' },
            'Tinapay': { category: 'food', english: 'Bread' },
            
            // Body Parts - Lesson 5
            'Ulo': { category: 'body', english: 'Head' },
            'Mata': { category: 'body', english: 'Eyes' },
            'Ilong': { category: 'body', english: 'Nose' },
            'Bibig': { category: 'body', english: 'Mouth' },
            'Kamay': { category: 'body', english: 'Hands' },
            
            // Family - Lesson 6
            'Nanay': { category: 'family', english: 'Mother' },
            'Tatay': { category: 'family', english: 'Father' },
            'Ate': { category: 'family', english: 'Sister' },
            'Kuya': { category: 'family', english: 'Brother' },
            'Lola': { category: 'family', english: 'Grandmother' },
            
            // Daily Words - Lesson 7
            'Kumusta': { category: 'daily', english: 'Hello' },
            'Salamat': { category: 'daily', english: 'Thank you' },
            'Pakisuyo': { category: 'daily', english: 'Please' },
            'Pasensya': { category: 'daily', english: 'Sorry' },
            'Paalam': { category: 'daily', english: 'Goodbye' },
            
            // Games - Lesson 8
            'Patintero': { category: 'games', english: 'Patintero' },
            'Taguan': { category: 'games', english: 'Hide and Seek' },
            'Habulan': { category: 'games', english: 'Tag' },
            'Luksong Lubid': { category: 'games', english: 'Jump Rope' },
            'Piko': { category: 'games', english: 'Hopscotch' },
            
            // Common Phrases
            'Magandang umaga': { category: 'phrases', english: 'Good morning' },
            'Kumusta ka': { category: 'phrases', english: 'How are you' },
            'Mahal ko ang pamilya ko': { category: 'phrases', english: 'I love my family' },
            'Gusto kong kumain ng kanin': { category: 'phrases', english: 'I want to eat rice' },
            'Anong kulay ito': { category: 'phrases', english: 'What color is this' },
            'Maglaro tayo ng patintero': { category: 'phrases', english: 'Let\'s play patintero' },
            'Pula ang damit ko': { category: 'phrases', english: 'My dress is red' },
            'Asul ang dagat': { category: 'phrases', english: 'The sea is blue' },
            'Berde ang damo': { category: 'phrases', english: 'The grass is green' },
            'May isang mansanas ako': { category: 'phrases', english: 'I have one apple' },
            'Dalawang pusa ang naglalaro': { category: 'phrases', english: 'Two cats are playing' },
            'Tumatahol ang aso': { category: 'phrases', english: 'The dog is barking' },
            'Nakakita ako ng ibon': { category: 'phrases', english: 'I see a bird' },
            'Natutulog ang pusa': { category: 'phrases', english: 'The cat is sleeping' },
            'Matamis ang mangga': { category: 'phrases', english: 'The mango is sweet' },
            'Kumain ka na ba': { category: 'phrases', english: 'Have you eaten' },
            'Gutom na ako': { category: 'phrases', english: 'I\'m hungry' },
            'Masarap ito': { category: 'phrases', english: 'This is delicious' },
            'Hawakan ang ulo mo': { category: 'phrases', english: 'Touch your head' },
            'Pikit ang mata mo': { category: 'phrases', english: 'Close your eyes' },
            'Buksan ang bibig mo': { category: 'phrases', english: 'Open your mouth' },
            'Palakpakan ang kamay mo': { category: 'phrases', english: 'Clap your hands' },
            'Nasaan si Nanay': { category: 'phrases', english: 'Where is mother' },
            'Nagtatrabaho si Tatay': { category: 'phrases', english: 'Father is working' },
            'Mabait ang ate ko': { category: 'phrases', english: 'My sister is kind' },
            'Nagkukuwento si Lola': { category: 'phrases', english: 'Grandmother tells stories' },
            'Laro tayo': { category: 'phrases', english: 'Let\'s play' },
            'Nauuhaw ako': { category: 'phrases', english: 'I\'m thirsty' },
            'Tulungan mo ako': { category: 'phrases', english: 'Help me please' },
            'Ikaw ang taya': { category: 'phrases', english: 'You\'re it' },
            'Nakita kita': { category: 'phrases', english: 'I found you' },
            'Ako naman ang magtago': { category: 'phrases', english: 'My turn to hide' },
            'Masaya ang mga laro': { category: 'phrases', english: 'Games are fun' }
        };
        
        // Generated Filipino audio URLs (will be populated by the audio generation system)
        let filipinoAudioUrls = {};
        
        // üéµ ENHANCED FILIPINO AUDIO GENERATION SYSTEM üéµ
        let currentVoiceGender = 'female'; // Alternate between male and female
        
        async function generateFilipinoPronunciation(text, retries = 3) {
            return new Promise((resolve) => {
                if (!('speechSynthesis' in window)) {
                    console.log('‚ùå Speech synthesis not supported');
                    resolve(null);
                    return;
                }
                
                // Wait for voices to load
                const waitForVoices = () => {
                    const voices = speechSynthesis.getVoices();
                    if (voices.length === 0 && retries > 0) {
                        setTimeout(() => {
                            generateFilipinoPronunciation(text, retries - 1).then(resolve);
                        }, 100);
                        return;
                    }
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // Enhanced Filipino pronunciation settings
                    utterance.rate = 0.4; // Much slower for clear learning
                    utterance.pitch = currentVoiceGender === 'female' ? 1.4 : 0.8; // Higher for female, lower for male
                    utterance.volume = 1.0;
                    
                    // Comprehensive Filipino voice selection
                    let selectedVoice = findBestFilipinoVoice(voices, currentVoiceGender);
                    
                    if (selectedVoice) {
                        utterance.voice = selectedVoice;
                        utterance.lang = selectedVoice.lang;
                        console.log(`üé§ Using ${currentVoiceGender} voice: ${selectedVoice.name} (${selectedVoice.lang})`);
                    }
                    
                    // Apply comprehensive Filipino pronunciation improvements
                    utterance.text = applyFilipinoPhonetics(text);
                    
                    utterance.onstart = () => {
                        console.log(`üéµ Generating ${currentVoiceGender} audio for: "${text}"`);
                    };
                    
                    utterance.onend = () => {
                        console.log(`‚úÖ Audio generated for: "${text}"`);
                        audioGenerationStatus.generated++;
                        updateAudioGenerationProgress();
                        // Alternate gender for next word
                        currentVoiceGender = currentVoiceGender === 'female' ? 'male' : 'female';
                        resolve(true);
                    };
                    
                    utterance.onerror = (event) => {
                        console.error(`‚ùå Audio generation failed for "${text}":`, event.error);
                        audioGenerationStatus.failed++;
                        updateAudioGenerationProgress();
                        resolve(false);
                    };
                    
                    speechSynthesis.speak(utterance);
                };
                
                if (speechSynthesis.getVoices().length === 0) {
                    speechSynthesis.onvoiceschanged = waitForVoices;
                } else {
                    waitForVoices();
                }
            });
        }
        
        // Find the best Filipino voice based on comprehensive criteria
        function findBestFilipinoVoice(voices, preferredGender) {
            console.log('üîç Available voices:', voices.map(v => `${v.name} (${v.lang})`));
            
            // Priority 1: Native Filipino/Tagalog voices
            const nativeFilipinoVoices = voices.filter(voice => 
                voice.lang.includes('fil') || 
                voice.lang.includes('tl') ||
                voice.name.toLowerCase().includes('filipino') ||
                voice.name.toLowerCase().includes('tagalog')
            );
            
            if (nativeFilipinoVoices.length > 0) {
                const genderFiltered = nativeFilipinoVoices.filter(voice => 
                    isVoiceGender(voice, preferredGender)
                );
                if (genderFiltered.length > 0) return genderFiltered[0];
                return nativeFilipinoVoices[0];
            }
            
            // Priority 2: Southeast Asian English voices (closer accent)
            const seAsianVoices = voices.filter(voice => 
                voice.lang.includes('en-PH') || // Philippines English
                voice.lang.includes('en-MY') || // Malaysian English
                voice.lang.includes('en-SG') || // Singapore English
                voice.name.toLowerCase().includes('philippines') ||
                voice.name.toLowerCase().includes('philippine') ||
                voice.name.toLowerCase().includes('manila')
            );
            
            if (seAsianVoices.length > 0) {
                const genderFiltered = seAsianVoices.filter(voice => 
                    isVoiceGender(voice, preferredGender)
                );
                if (genderFiltered.length > 0) return genderFiltered[0];
                return seAsianVoices[0];
            }
            
            // Priority 3: High-quality English voices with gender preference
            const qualityVoices = voices.filter(voice => 
                voice.lang.includes('en-US') || voice.lang.includes('en-GB')
            );
            
            const genderFiltered = qualityVoices.filter(voice => 
                isVoiceGender(voice, preferredGender)
            );
            
            if (genderFiltered.length > 0) return genderFiltered[0];
            if (qualityVoices.length > 0) return qualityVoices[0];
            
            // Fallback: Any available voice
            return voices.length > 0 ? voices[0] : null;
        }
        
        // Determine voice gender based on name patterns
        function isVoiceGender(voice, preferredGender) {
            const name = voice.name.toLowerCase();
            
            const femaleIndicators = [
                'female', 'woman', 'girl', 'samantha', 'karen', 'susan', 'victoria', 
                'anna', 'maria', 'elena', 'sophia', 'amelie', 'zoe', 'tessa', 'fiona',
                'paulina', 'carmit', 'lekha', 'nicky', 'kyoko', 'mei-jia'
            ];
            
            const maleIndicators = [
                'male', 'man', 'boy', 'alex', 'daniel', 'david', 'fred', 'jorge',
                'juan', 'diego', 'carlos', 'thomas', 'rishi', 'otoya', 'sin-ji'
            ];
            
            if (preferredGender === 'female') {
                return femaleIndicators.some(indicator => name.includes(indicator));
            } else {
                return maleIndicators.some(indicator => name.includes(indicator));
            }
        }
        
        // Comprehensive Filipino phonetic adjustments
        function applyFilipinoPhonetics(text) {
            let adjustedText = text;
            
            // Comprehensive Filipino pronunciation map
            const filipinoPhonetics = {
                // Basic words with proper Filipino pronunciation
                'Pula': 'Poo-lah',
                'Asul': 'Ah-sool',
                'Berde': 'Ber-deh',
                'Itim': 'Ee-tim',
                'Puti': 'Poo-tee',
                'Isa': 'Ee-sah',
                'Dalawa': 'Dah-lah-wah',
                'Tatlo': 'Taht-loh',
                'Apat': 'Ah-paht',
                'Lima': 'Lee-mah',
                'Aso': 'Ah-soh',
                'Pusa': 'Poo-sah',
                'Ibon': 'Ee-bohn',
                'Isda': 'Ees-dah',
                'Baka': 'Bah-kah',
                'Kanin': 'Kah-nin',
                'Saging': 'Sah-ging',
                'Mangga': 'Mahng-gah',
                'Tinapay': 'Tee-nah-pie',
                'Ulo': 'Oo-loh',
                'Mata': 'Mah-tah',
                'Ilong': 'Ee-lohng',
                'Bibig': 'Bee-big',
                'Kamay': 'Kah-my',
                'Nanay': 'Nah-ny',
                'Tatay': 'Tah-ty',
                'Ate': 'Ah-teh',
                'Kuya': 'Koo-yah',
                'Lola': 'Loh-lah',
                'Kumusta': 'Koo-moos-tah',
                'Salamat': 'Sah-lah-maht',
                'Pakisuyo': 'Pah-kee-soo-yoh',
                'Pasensya': 'Pah-sen-syah',
                'Paalam': 'Pah-ah-lahm',
                'Patintero': 'Pah-tin-teh-roh',
                'Taguan': 'Tah-goo-ahn',
                'Habulan': 'Hah-boo-lahn',
                'Luksong': 'Look-sohng',
                'Piko': 'Pee-koh',
                
                // Common phrases
                'Magandang umaga': 'Mah-gahn-dahng oo-mah-gah',
                'Kumusta ka': 'Koo-moos-tah kah',
                'Mahal ko': 'Mah-hahl koh',
                'ang pamilya ko': 'ahng pah-meel-yah koh',
                'Gusto kong kumain': 'Goos-toh kohng koo-mah-in',
                'ng kanin': 'nahng kah-nin',
                'Anong kulay ito': 'Ah-nohng koo-ly ee-toh',
                'Maglaro tayo': 'Mahg-lah-roh tah-yoh',
                'ng patintero': 'nahng pah-tin-teh-roh',
                
                // Common Filipino sounds
                'ng ': 'nahng ',
                'mga ': 'mah-gah ',
                'ang ': 'ahng ',
                'sa ': 'sah ',
                'na ': 'nah ',
                'ko ': 'koh ',
                'mo ': 'moh ',
                'ka ': 'kah ',
                'tayo ': 'tah-yoh ',
                'ako ': 'ah-koh ',
                'siya ': 'see-yah '
            };
            
            // Apply phonetic replacements
            for (const [filipino, phonetic] of Object.entries(filipinoPhonetics)) {
                const regex = new RegExp(filipino.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');
                adjustedText = adjustedText.replace(regex, phonetic);
            }
            
            // Additional phonetic rules for better pronunciation
            adjustedText = adjustedText
                .replace(/ng/g, 'nahng') // NG sound
                .replace(/√±/g, 'ny') // √ë sound
                .replace(/r/g, 'r') // Keep R rolling
                .replace(/\bng\b/g, 'nahng'); // Standalone NG
            
            return adjustedText;
        }
        
        // üöÄ GENERATE ALL FILIPINO AUDIO AUTOMATICALLY
        async function generateAllFilipinoPronunciations() {
            if (audioGenerationStatus.inProgress) {
                console.log('‚ö†Ô∏è Audio generation already in progress');
                return;
            }
            
            console.log('üöÄ Starting automatic Filipino audio generation...');
            audioGenerationStatus.inProgress = true;
            audioGenerationStatus.total = Object.keys(filipinoContent).length;
            audioGenerationStatus.generated = 0;
            audioGenerationStatus.failed = 0;
            
            showAudioGenerationModal();
            
            const words = Object.keys(filipinoContent);
            
            for (let i = 0; i < words.length; i++) {
                const word = words[i];
                const success = await generateFilipinoPronunciation(word);
                
                if (success) {
                    // Cache the audio for immediate use
                    filipinoAudioUrls[word] = `generated_${Date.now()}_${i}`;
                }
                
                // Small delay to prevent overwhelming the system
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            audioGenerationStatus.inProgress = false;
            
            console.log(`üéâ Audio generation complete!`);
            console.log(`‚úÖ Generated: ${audioGenerationStatus.generated}`);
            console.log(`‚ùå Failed: ${audioGenerationStatus.failed}`);
            
            hideAudioGenerationModal();
            
            // Save the generated audio URLs
            saveToLocalStorage();
            
            // Show completion message
            showAudioCompletionMessage();
        }
        
        function updateAudioGenerationProgress() {
            const progressElement = document.getElementById('audio-generation-progress');
            const statusElement = document.getElementById('audio-generation-status');
            
            if (progressElement && statusElement) {
                const progress = ((audioGenerationStatus.generated + audioGenerationStatus.failed) / audioGenerationStatus.total) * 100;
                progressElement.style.width = `${progress}%`;
                statusElement.textContent = `Generated: ${audioGenerationStatus.generated}/${audioGenerationStatus.total} (${audioGenerationStatus.failed} failed)`;
            }
        }
        
        function showAudioGenerationModal() {
            const modal = document.createElement('div');
            modal.id = 'audio-generation-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #FEF9F3, #ffffff);
                    padding: 40px;
                    border-radius: 20px;
                    text-align: center;
                    max-width: 500px;
                    width: 90%;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                ">
                    <h2 style="color: #C19A6B; margin-bottom: 20px;">üéµ Generating Filipino Audio</h2>
                    <p style="color: #C19A6B; margin-bottom: 30px;">Creating authentic pronunciations for all words and phrases...</p>
                    
                    <div style="background: #E5E5E5; height: 20px; border-radius: 10px; overflow: hidden; margin-bottom: 20px;">
                        <div id="audio-generation-progress" style="
                            background: linear-gradient(90deg, #2ECC71, #1ABC9C);
                            height: 100%;
                            width: 0%;
                            border-radius: 10px;
                            transition: width 0.3s ease;
                        "></div>
                    </div>
                    
                    <div id="audio-generation-status" style="color: #C19A6B; font-weight: 600;">
                        Starting generation...
                    </div>
                    
                    <div style="margin-top: 20px; font-size: 2rem;">
                        üé§üáµüá≠‚ú®
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function hideAudioGenerationModal() {
            const modal = document.getElementById('audio-generation-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function showAudioCompletionMessage() {
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #2ECC71, #1ABC9C);
                color: white;
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3);
                z-index: 10000;
                font-weight: 600;
                max-width: 300px;
            `;
            
            message.innerHTML = `
                <div style="font-size: 1.2rem; margin-bottom: 10px;">üéâ Audio Generation Complete!</div>
                <div style="font-size: 0.9rem;">
                    ‚úÖ ${audioGenerationStatus.generated} pronunciations ready<br>
                    üéµ Your SalinWika now has authentic Filipino audio!
                </div>
            `;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.remove();
            }, 5000);
        }
        
        function playNativeAudio(text) {
            // First try to play native Filipino audio
            if (filipinoAudioUrls[text]) {
                try {
                    let audio = audioCache.get(text);
                    if (!audio) {
                        audio = new Audio(filipinoAudioUrls[text]);
                        audio.preload = 'auto';
                        audioCache.set(text, audio);
                    }
                    
                    audio.currentTime = 0;
                    const playPromise = audio.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('‚úÖ Playing native Filipino audio for:', text);
                        }).catch(error => {
                            console.log('‚ö†Ô∏è Native audio failed, using fallback TTS');
                            fallbackToTTS(text);
                        });
                    }
                    return true;
                } catch (error) {
                    console.log('‚ö†Ô∏è Native audio error, using fallback TTS');
                    return fallbackToTTS(text);
                }
            } else {
                // Fallback to enhanced TTS
                return fallbackToTTS(text);
            }
        }
        
        function fallbackToTTS(text, isDialect = false) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Enhanced Filipino pronunciation settings
                utterance.rate = isDialect ? 0.3 : 0.4; // Even slower for dialects
                utterance.pitch = currentVoiceGender === 'female' ? 1.4 : 0.8;
                utterance.volume = 1.0;
                
                const voices = speechSynthesis.getVoices();
                let selectedVoice = findBestFilipinoVoice(voices, currentVoiceGender);
                
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                    utterance.lang = selectedVoice.lang;
                    console.log(`üîä Using ${currentVoiceGender} TTS voice:`, selectedVoice.name, selectedVoice.lang);
                }
                
                // Apply comprehensive Filipino phonetics
                utterance.text = applyFilipinoPhonetics(text);
                
                utterance.onstart = () => {
                    console.log(`üîä TTS started for ${isDialect ? 'dialect' : 'Filipino'}:`, text);
                };
                
                utterance.onerror = (event) => {
                    console.error('‚ùå TTS error:', event.error);
                };
                
                utterance.onend = () => {
                    // Alternate gender for next pronunciation
                    currentVoiceGender = currentVoiceGender === 'female' ? 'male' : 'female';
                };
                
                speechSynthesis.speak(utterance);
                return true;
            }
            return false;
        }
        
        // Enhanced function to play dialect audio
        function playDialectAudio(text) {
            console.log('üó£Ô∏è Playing dialect audio for:', text);
            return fallbackToTTS(text, true);
        }
        
        // Main function to speak text (replaces the old speakText function)
        function speakText(text, lang = 'fil-PH') {
            return playNativeAudio(text);
        }
        
        // Function to render visual content (emoji, SVG, or image)
        function renderVisual(emoji, imageUrl) {
            if (imageUrl && imageUrl.startsWith('http')) {
                // External image URL
                return `<img src="${imageUrl}" alt="Visual" style="width: 80px; height: 80px; object-fit: cover; border-radius: 10px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div style="display: none; font-size: 4rem;">${emoji || 'üìù'}</div>`;
            } else if (imageUrl && imageUrl.startsWith('<svg')) {
                // SVG content
                return `<div style="width: 80px; height: 80px; display: flex; align-items: center; justify-content: center;">${imageUrl}</div>`;
            } else if (imageUrl && imageUrl.startsWith('data:image')) {
                // Base64 image
                return `<img src="${imageUrl}" alt="Visual" style="width: 80px; height: 80px; object-fit: cover; border-radius: 10px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div style="display: none; font-size: 4rem;">${emoji || 'üìù'}</div>`;
            } else {
                // Default to emoji
                return emoji || 'üìù';
            }
        }
        
        function selectLesson(lessonNumber) {
            currentLesson = lessonNumber;
            currentStep = 1;
            
            // Update lesson selector
            document.querySelectorAll('.lesson-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelectorAll('.lesson-card')[lessonNumber - 1].classList.add('active');
            
            // Update lesson title
            document.getElementById('current-lesson-title').textContent = lessons[lessonNumber].title;
            
            // Load lesson content
            loadLessonContent();
            updateProgress();
            updateNavigationButtons();
            saveToLocalStorage(); // Auto-save when lesson changes
        }
        
        function loadLessonContent() {
            const lesson = lessons[currentLesson];
            const content = document.getElementById('lesson-content');
            
            content.innerHTML = `
                <!-- Step 1: Introduction -->
                <div class="step-content active" id="step-1">
                    <div class="intro-section">
                        <div class="intro-emoji">${lesson.emoji}</div>
                        <div class="intro-text">
                            <strong>Hi there! Welcome to SalinWika! üéâ</strong><br>
                            Let's have fun learning Filipino words, songs, and stories. Tap, play, and speak your way through games and quizzes. üåûüìöüñçÔ∏è<br>
                            Every word you learn helps you connect with your family, your culture, and the generations before you. üåü<br>
                            Ready to start? Let's go! üöÄ
                        </div>
                        <button class="play-sound" onclick="playIntroAudio()">üîä Listen to Introduction</button>
                    </div>
                </div>
                
                <!-- Step 2: Vocabulary -->
                <div class="step-content" id="step-2">
                    <h2 style="text-align: center; margin-bottom: 30px; font-size: 2.5rem; color: #C19A6B;">üìö Learn New Words</h2>
                    
                    <div class="add-word-section">
                        <h3 style="color: #2ECC71; margin-bottom: 15px;">‚ûï Add Your Own Words</h3>
                        <p style="color: #C19A6B; margin-bottom: 20px;">Want to learn more words? Add your own vocabulary!</p>
                        <button class="add-word-btn" onclick="openAddModal('vocabulary')">‚ûï Add New Word</button>
                    </div>
                    
                    <div class="vocabulary-grid" id="vocab-grid">
                        ${lesson.vocabulary.map((item, index) => `
                            <div class="vocab-card" onclick="playVocabSound('${item.filipino}')">
                                <button class="edit-btn" onclick="editItem('vocabulary', ${index})" title="Edit">‚úèÔ∏è</button>
                                <div class="vocab-emoji">${renderVisual(item.emoji, item.image)}</div>
                                <div class="vocab-english">${item.english}</div>
                                <div class="vocab-filipino">${item.filipino}</div>
                                ${item.dialect ? `<div class="vocab-dialect" style="font-size: 0.9rem; color: #E74C3C; font-weight: 500; margin: 5px 0; cursor: pointer;" onclick="event.stopPropagation(); playDialectAudio('${item.dialect}')" title="Click to hear dialect pronunciation">üó£Ô∏è ${item.dialect}</div>` : ''}
                                <button class="play-sound">üîä Play Filipino</button>
                                ${item.dialect ? `<button class="play-sound" onclick="event.stopPropagation(); playDialectAudio('${item.dialect}')" style="background: linear-gradient(135deg, #9B59B6, #8E44AD); margin-top: 5px;">üó£Ô∏è Play Dialect</button>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Step 3: Matching Game -->
                <div class="step-content" id="step-3">
                    <div class="game-area">
                        <div class="game-question">üéØ Match the English words with Filipino translations!</div>
                        <div class="matching-container" id="matching-container">
                            <div class="matching-column">
                                <h3>üá∫üá∏ English</h3>
                                <div id="english-items">
                                    ${lesson.vocabulary.slice(0, 4).map((item, index) => `
                                        <div class="match-item" data-type="english" data-value="${item.english}" onclick="selectMatchItem(this)">
                                            ${item.emoji} ${item.english}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <div class="matching-column">
                                <h3>üáµüá≠ Filipino</h3>
                                <div id="filipino-items">
                                    ${lesson.vocabulary.slice(0, 4).sort(() => Math.random() - 0.5).map((item, index) => `
                                        <div class="match-item" data-type="filipino" data-value="${item.filipino}" data-english="${item.english}" onclick="selectMatchItem(this)">
                                            ${item.filipino}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <div id="game-feedback" style="font-size: 1.5rem; font-weight: 700; margin: 15px 0;"></div>
                            <div id="game-score" style="color: #C19A6B;">Matches: <span id="score">${matchingGame.matches}</span>/${lesson.vocabulary.slice(0, 4).length}</div>
                            <button class="practice-button" onclick="resetMatchingGame()" style="margin-top: 15px;">üîÑ Reset Game</button>
                        </div>
                    </div>
                </div>
                
                <!-- Step 4: Phrases -->
                <div class="step-content" id="step-4">
                    <h2 style="text-align: center; margin-bottom: 30px; font-size: 2.5rem; color: #C19A6B;">üí¨ Useful Phrases</h2>
                    
                    <div class="parent-guide">
                        <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent Guide</h3>
                        <p><strong>Practice at home:</strong> Use these phrases during daily activities. Encourage your child to respond in Filipino.</p>
                        <p><strong>Make it fun:</strong> Turn phrase practice into role-playing games or daily conversations.</p>
                    </div>
                    
                    <div class="add-word-section">
                        <h3 style="color: #2ECC71; margin-bottom: 15px;">‚ûï Add Your Own Phrases</h3>
                        <p style="color: #C19A6B; margin-bottom: 20px;">Add phrases your family uses every day!</p>
                        <button class="add-word-btn" onclick="openAddModal('phrases')">‚ûï Add New Phrase</button>
                    </div>
                    
                    <div class="phrases-section">
                        ${lesson.phrases.map((phrase, index) => `
                            <div class="phrase-card" onclick="speakText('${phrase.filipino}')">
                                <button class="edit-btn" onclick="editItem('phrases', ${index})" title="Edit">‚úèÔ∏è</button>
                                <div class="phrase-english">${phrase.english}</div>
                                <div class="phrase-filipino">${phrase.filipino}</div>
                                ${phrase.dialect ? `<div class="phrase-dialect" style="font-size: 1rem; color: #E74C3C; font-weight: 500; margin: 5px 0; font-style: italic;">${phrase.dialect}</div>` : ''}
                                <button class="play-sound" style="margin-top: 10px;">üîä Listen</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Step 5: Song -->
                <div class="step-content" id="step-5">
                    <div class="song-section">
                        <div class="song-title">üéµ ${lesson.song.title}</div>
                        <div class="song-lyrics">${lesson.song.lyrics}</div>
                        <button class="play-song" onclick="playSong()">üéµ Play Song</button>
                    </div>
                </div>
                
                <!-- Step 6: Review -->
                <div class="step-content" id="step-6">
                    <h2 style="text-align: center; margin-bottom: 30px; font-size: 2.5rem; color: #C19A6B;">üèÜ Practice & Review</h2>
                    
                    <div class="memory-boost">
                        <h3>üß† Memory Boost</h3>
                        <p>Practice these words every day for 5 minutes. Repetition helps you remember better!</p>
                        <button onclick="startSpacedPractice()" class="practice-button">
                            üîÑ Start Practice Session
                        </button>
                    </div>
                    
                    <div class="vocabulary-grid">
                        ${lesson.vocabulary.map(item => `
                            <div class="vocab-card" onclick="reviewWord('${item.filipino}')">
                                <div class="vocab-emoji">${item.emoji}</div>
                                <div class="vocab-filipino">${item.filipino}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <div style="font-size: 2rem; margin: 20px 0;">üéâ Congratulations! üéâ</div>
                        <div style="font-size: 1.3rem; color: #C19A6B;">You've completed ${lesson.title}!</div>
                        <div style="margin: 20px 0;">
                            <span style="font-size: 2rem; color: #E74C3C;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Initialize matching game
            matchingGame = {
                selectedLeft: null,
                selectedRight: null,
                matches: 0,
                total: lesson.vocabulary.slice(0, 4).length
            };
            
            showStep(1);
        }
        
        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.lesson-step').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected step
            const stepElement = document.getElementById(`step-${step}`);
            if (stepElement) {
                stepElement.classList.add('active');
                document.querySelectorAll('.lesson-step')[step - 1].classList.add('active');
                
                // Mark completed steps
                for (let i = 0; i < step - 1; i++) {
                    document.querySelectorAll('.lesson-step')[i].classList.add('completed');
                }
                
                currentStep = step;
                updateProgress();
                updateNavigationButtons();
                saveToLocalStorage(); // Auto-save when navigating between steps
            }
        }
        
        function updateProgress() {
            const progress = (currentStep / 6) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }
        
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            prevBtn.disabled = currentStep === 1;
            nextBtn.disabled = currentStep === 6;
            
            if (currentStep === 6) {
                nextBtn.textContent = "üéâ Complete!";
            } else {
                nextBtn.textContent = "Next ‚Üí";
            }
        }
        
        function previousStep() {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }
        
        function nextStep() {
            if (currentStep < 6) {
                showStep(currentStep + 1);
            }
        }
        
        // Matching Game Functions
        function selectMatchItem(element) {
            const type = element.dataset.type;
            const value = element.dataset.value;
            
            if (type === 'english') {
                // Clear previous selection
                document.querySelectorAll('[data-type="english"]').forEach(item => {
                    item.classList.remove('selected');
                });
                element.classList.add('selected');
                matchingGame.selectedLeft = element;
            } else {
                // Clear previous selection
                document.querySelectorAll('[data-type="filipino"]').forEach(item => {
                    item.classList.remove('selected');
                });
                element.classList.add('selected');
                matchingGame.selectedRight = element;
            }
            
            // Check for match
            if (matchingGame.selectedLeft && matchingGame.selectedRight) {
                checkMatch();
            }
        }
        
        function checkMatch() {
            const englishValue = matchingGame.selectedLeft.dataset.value;
            const filipinoEnglish = matchingGame.selectedRight.dataset.english;
            
            const feedback = document.getElementById('game-feedback');
            
            if (englishValue === filipinoEnglish) {
                // Correct match
                matchingGame.selectedLeft.classList.add('correct');
                matchingGame.selectedRight.classList.add('correct');
                matchingGame.selectedLeft.onclick = null;
                matchingGame.selectedRight.onclick = null;
                matchingGame.matches++;
                
                const encouragingMessages = [
                    "üéâ You got it! ‚≠ê‚≠ê‚≠ê",
                    "üåü Wow! You just spoke like a Filipino hero!",
                    "üéØ Perfect match! You're amazing!",
                    "‚ú® Great job! Keep going!",
                    "üèÜ Fantastic! You're learning so fast!",
                    "üåà Brilliant! Your family would be proud!",
                    "üéä Outstanding work! You're a star!",
                    "üí´ Incredible! You're connecting with your culture!"
                ];
                feedback.textContent = encouragingMessages[Math.floor(Math.random() * encouragingMessages.length)];
                feedback.style.color = "#2ECC71";
                
                // Play the Filipino word
                speakText(matchingGame.selectedRight.dataset.value);
                
                // Update score
                document.getElementById('score').textContent = matchingGame.matches;
                
                if (matchingGame.matches === matchingGame.total) {
                    const completionMessages = [
                        "üèÜ All matched! Great job!",
                        "üéâ Perfect! You're a Filipino language champion!",
                        "üåü Amazing! You completed the whole game!",
                        "üéä Fantastic work! Your ancestors would be proud!",
                        "üí´ Incredible! You're mastering Filipino!"
                    ];
                    setTimeout(() => {
                        feedback.textContent = completionMessages[Math.floor(Math.random() * completionMessages.length)];
                    }, 1500);
                }
            } else {
                // Incorrect match
                const tryAgainMessages = [
                    "ü§ó Try again, you're doing great!",
                    "üí™ Keep trying! You've got this!",
                    "üåü Almost there! Give it another try!",
                    "üéØ So close! Try once more!",
                    "‚ú® Don't give up! You're learning!"
                ];
                feedback.textContent = tryAgainMessages[Math.floor(Math.random() * tryAgainMessages.length)];
                feedback.style.color = "#E74C3C";
                
                setTimeout(() => {
                    matchingGame.selectedLeft.classList.remove('selected');
                    matchingGame.selectedRight.classList.remove('selected');
                    feedback.textContent = "";
                }, 1000);
            }
            
            matchingGame.selectedLeft = null;
            matchingGame.selectedRight = null;
        }
        
        function resetMatchingGame() {
            matchingGame.matches = 0;
            document.getElementById('score').textContent = '0';
            document.getElementById('game-feedback').textContent = '';
            
            // Reset all items
            document.querySelectorAll('.match-item').forEach(item => {
                item.classList.remove('selected', 'correct');
                item.onclick = function() { selectMatchItem(this); };
            });
            
            // Shuffle Filipino items
            const filipinoContainer = document.getElementById('filipino-items');
            const items = Array.from(filipinoContainer.children);
            items.sort(() => Math.random() - 0.5);
            items.forEach(item => filipinoContainer.appendChild(item));
        }
        
        // Edit and Add Functions
        function editItem(type, index) {
            event.stopPropagation();
            currentEditType = type;
            currentEditIndex = index;
            
            const lesson = lessons[currentLesson];
            const item = lesson[type][index];
            
            document.getElementById('editEnglish').value = item.english;
            document.getElementById('editFilipino').value = item.filipino;
            document.getElementById('editDialect').value = item.dialect || '';
            document.getElementById('editEmoji').value = item.emoji || '';
            document.getElementById('editImage').value = item.image || '';
            
            document.getElementById('editModal').style.display = 'block';
        }
        
        function showSuccessMessage(message) {
            const successDiv = document.createElement('div');
            successDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #2ECC71, #1ABC9C);
                color: white;
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3);
                z-index: 10000;
                font-weight: 600;
                max-width: 350px;
                animation: slideIn 0.3s ease;
            `;
            
            successDiv.innerHTML = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (successDiv.parentNode) {
                        successDiv.parentNode.removeChild(successDiv);
                    }
                }, 300);
            }, 4000);
        }
        
        function openAddModal(type) {
            currentEditType = type;
            currentEditIndex = -1;
            
            const lesson = lessons[currentLesson];
            const currentCount = lesson[type].length;
            const maxWords = type === 'vocabulary' ? 20 : 15;
            
            if (currentCount >= maxWords) {
                alert(`You've reached the maximum of ${maxWords} ${type === 'vocabulary' ? 'words' : 'phrases'} per lesson. You currently have ${currentCount}/${maxWords}.`);
                return;
            }
            
            document.getElementById('addEnglish').value = '';
            document.getElementById('addFilipino').value = '';
            document.getElementById('addDialect').value = '';
            document.getElementById('addEmoji').value = '';
            document.getElementById('addImage').value = '';
            
            document.getElementById('addModal').style.display = 'block';
        }
        
        function saveEdit() {
            const english = document.getElementById('editEnglish').value.trim();
            const filipino = document.getElementById('editFilipino').value.trim();
            const dialect = document.getElementById('editDialect').value.trim();
            const emoji = document.getElementById('editEmoji').value.trim();
            const image = document.getElementById('editImage').value.trim();
            
            if (!english || !filipino) {
                alert('Please fill in both English and Filipino fields!');
                return;
            }
            
            const lesson = lessons[currentLesson];
            lesson[currentEditType][currentEditIndex] = {
                english: english,
                filipino: filipino,
                dialect: dialect || '',
                emoji: emoji || 'üìù',
                image: image || ''
            };
            
            closeModal();
            loadLessonContent();
            showStep(currentStep);
            saveToLocalStorage(); // Auto-save after edit
        }
        
        function addNewWord() {
            const english = document.getElementById('addEnglish').value.trim();
            const filipino = document.getElementById('addFilipino').value.trim();
            const dialect = document.getElementById('addDialect').value.trim();
            const emoji = document.getElementById('addEmoji').value.trim();
            const image = document.getElementById('addImage').value.trim();
            
            if (!english || !filipino) {
                alert('Please fill in both English and Filipino fields!');
                return;
            }
            
            const lesson = lessons[currentLesson];
            
            // Check current limits
            const currentCount = lesson[currentEditType].length;
            const maxWords = currentEditType === 'vocabulary' ? 20 : 15; // 20 words, 15 phrases max per lesson
            
            if (currentCount >= maxWords) {
                alert(`You can add up to ${maxWords} ${currentEditType === 'vocabulary' ? 'words' : 'phrases'} per lesson. You currently have ${currentCount}.`);
                return;
            }
            
            lesson[currentEditType].push({
                english: english,
                filipino: filipino,
                dialect: dialect || '',
                emoji: emoji || 'üìù',
                image: image || ''
            });
            
            closeModal();
            loadLessonContent();
            showStep(currentStep);
            saveToLocalStorage(); // Auto-save after adding
            
            // Show success message
            showSuccessMessage(`‚úÖ Added new ${currentEditType === 'vocabulary' ? 'word' : 'phrase'}! You now have ${currentCount + 1}/${maxWords} ${currentEditType === 'vocabulary' ? 'words' : 'phrases'} in this lesson.`);
        }
        
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            document.getElementById('addModal').style.display = 'none';
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const editModal = document.getElementById('editModal');
            const addModal = document.getElementById('addModal');
            if (event.target === editModal) {
                editModal.style.display = 'none';
            }
            if (event.target === addModal) {
                addModal.style.display = 'none';
            }
        }
        
        function playIntroAudio() {
            const button = event.target;
            button.textContent = "üîä Playing...";
            button.style.background = "linear-gradient(135deg, #2ECC71, #1ABC9C)";
            
            const lesson = lessons[currentLesson];
            const introText = `Hi there! Welcome to SalinWika! Let's have fun learning Filipino words, songs, and stories. Tap, play, and speak your way through games and quizzes. Every word you learn helps you connect with your family, your culture, and the generations before you. Ready to start? Let's go!`;
            
            if (speakText(introText, 'en-US')) {
                setTimeout(() => {
                    button.textContent = "üîä Listen to Introduction";
                    button.style.background = "linear-gradient(135deg, #E74C3C, #C0392B)";
                }, 5000);
            }
        }
        
        function playVocabSound(word) {
            const card = event.currentTarget;
            const originalTransform = card.style.transform;
            card.style.transform = "scale(1.1)";
            card.style.boxShadow = "0 25px 60px rgba(26, 188, 156, 0.3)";
            
            speakText(word);
            
            setTimeout(() => {
                card.style.transform = originalTransform;
                card.style.boxShadow = "0 10px 30px rgba(193, 154, 107, 0.1)";
            }, 500);
        }
        
        function playSong() {
            const button = event.target;
            button.textContent = "üéµ Playing...";
            button.style.background = "linear-gradient(135deg, #2ECC71, #1ABC9C)";
            
            const lesson = lessons[currentLesson];
            const songText = lesson.song.lyrics.replace(/<br>/g, ' ');
            speakText(songText);
            
            setTimeout(() => {
                button.textContent = "üéµ Play Song";
                button.style.background = "linear-gradient(135deg, #E74C3C, #C0392B)";
            }, 8000);
        }
        
        function reviewWord(word) {
            const card = event.target;
            const originalTransform = card.style.transform;
            card.style.transform = "scale(1.2)";
            
            speakText(word);
            
            setTimeout(() => {
                card.style.transform = originalTransform;
            }, 300);
        }
        
        function startSpacedPractice() {
            const lesson = lessons[currentLesson];
            const button = event.target;
            button.textContent = "üîÑ Practicing...";
            button.disabled = true;
            
            let index = 0;
            const practiceWords = lesson.vocabulary.map(item => item.filipino);
            
            function practiceNext() {
                if (index >= practiceWords.length) {
                    button.textContent = "‚úÖ Practice Complete!";
                    button.style.background = "linear-gradient(135deg, #2ECC71, #1ABC9C)";
                    
                    setTimeout(() => {
                        button.textContent = "üîÑ Start Practice Session";
                        button.style.background = "linear-gradient(135deg, #E74C3C, #C0392B)";
                        button.disabled = false;
                    }, 3000);
                    return;
                }
                
                speakText(practiceWords[index]);
                index++;
                
                setTimeout(practiceNext, 2000);
            }
            
            practiceNext();
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Try to restore previous session
            const restored = loadFromLocalStorage();
            if (restored) {
                // Update UI to reflect restored state
                selectLesson(currentLesson);
                showStep(currentStep);
                console.log('üéâ Welcome back! Your progress has been restored.');
            } else {
                loadLessonContent();
                updateProgress();
                updateNavigationButtons();
            }
        });
        
        // Load voices when available
        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = function() {
                // Voices are now loaded
            };
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'974d7192f3b9eda2',t:'MTc1NjE0OTU5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
